# HTTPS

[개념 Flow]

1. HTTP : 클라이언트-서버 간의 요청/응답 프로토콜

2. HTTP 통신은 암호화 X, 통신 상대를 확인 X, 정보 위조 가능
3. 이런 문제를 보완하기 위해 HTTP 프로토콜에 SSL 프로토콜을 조합한 것이 HTTPS 프로토콜
   - 통신을 하는 소켓을 SSL/TLS 프로토콜로 대체
   - SSL을 사용하면 암호화, 통신 상대 보증 가능



[동작 Flow]

1. (서버) 믿을 수 있는 서버인지 확인하는 작업을 거치고 CA 기관에 **서버의 공개키** 전달, **CA 기관의 개인키** 로 암호화된 SSL 인증서를 발급받음

2. (클라이언트) 서버에 <u>Client Random Data</u>와 <u>브라우저가 지원하는 암호화 기법 목록</u>을 전달

3. (서버) 클라이언트에 <u>Server Random Data</u>와 <u>사용할 암호화 기법</u>, <u>**서버의 공개키**가 포함된 인증서</u>를 전달

4. (클라이언트) 인증서가 믿을만한지 확인 (공인된 CA 기관은 브라우저 내부에 저장되어 있음; 사설 CA는 브라우저에 저장되어 있지 않음)

   - (클라이언트) 브라우저 내부에 있는 **CA 기관 공개키 **로 인증서를 복호화

     -> CA가 인증한 믿을만한 서버인지 확인 + 서버가 보낸 **서버의 공개키** 확인

5. (클라이언트) 주고 받은 Random Data를 이용해 통신에 사용할 **대칭키**를 생성, **서버의 공개키**로 암호화 후 전달

6. (서버) 클라이언트가 보낸 데이터를 **서버의 개인키** 로 복호화하여 **대칭키** 확보

7. HTTPS 통신
8. 대칭키 폐기 (통신 종료)



## HTTPS with AWS

1. 도메인 구입 (필수)
2. ACM에서 SSL 인증서 발급

3. 로드밸런서 생성
   1. HTTPS 통신으로 오는 443 포트 리스너에 등록
   2. HTTPS 리스너에 SSL 인증서 등록
4. 리디렉션할 Target Group 생성 (어떤 인스턴스에 어떤 프로토콜과 포트로 요청을 보낼지 선택)

5. 로드밸런서의 리스너에 Target Group 연동



---

1) `도메인 구입` - CA 기관에 보내 검증할 도메인 확보
2) `ACM` - SSL 인증서 발급 기관 / 생성 시 도메인 이름이 필수적이고 CNAME 검증을 마쳐야 활성화됨
3) `로드밸런서` - Application level에서 분기 (Application Load Balancer 사용) / ALB에서 HTTPS 포트 접근에 대한 SSL 선택 필수
4) `Target Group` - 인스턴스 타겟 설정 / ALB를 통해 접근할 EC2 인스턴스 선택 후 접근할 때 사용할 포트 선택



---

- freenom 도메인 구입 완료

- freenom 도메인에 대한 ACM 인증서 등록 완료

- 로드밸런서의 HTTPS 프로토콜에 대해 ACM 인증서 선택

=> HTTP 프로토콜은 되는데 HTTPS는 **ERR_CERT_COMMON_NAME_INVALID** 발생

